= Android Test Automation =

////////////////////////////////////////////////////////////////////////////////
Google Alerts: android monkeyrunner instrumentation functional
////////////////////////////////////////////////////////////////////////////////

NOTE: 如果要自行埋 link:android-viewserver.html[View Server] 到個別的 app，就會遭遇只能測單一個 app 的問題。不過內嵌 Viewser 的做法好像比 Robotium 走 intrumentation 來得好？至少可以繼續用 monkeyrunner 這個官方的測試工具。

Android 的測試方式可粗分為三種：

 * 基於 JUnit 和 link:android-instrumentation.html[Instrumentation] 的 unit-level 測試，但對象是個別的 component，比一般所認知的 class 再 high-level 一點。
 * 基於 Python 跟 link:../monkeyrunner/monkeyrunner-api.html[monkeyrunner API] 的 functional-level 測試，對象是整個 application，重在 component 間的整合。
 * 基於 link:android-monkey.html[Monkey] 的壓力測試，對象也是整個 application。

當然還有一些 TaaS...

mock, QA 的測試是 integration ...

black box? 適合 QA test? 整合 L10N? 重在 integration ... 學習曲線，用 JUnit 寫好像要求有點太高了？... 它可能比較好，但可能把自己累死 ...要 L10N 去安插截圖的動作更難。感覺 JUnit 比較封閉，無法交錯 applications 間的測試。

一直無法說服自己放棄 Robotium，或許要等它的 Remote Control 吧？ 最後用 Robot Framework 的 Remote Library 全部包裝成 keywords!!

不是 Robotium/Instrumnetation 不好，只是這些 test tools 要考量到方不方便跟 test framework 整合（才能間接整合其他的測試工具），其他 QA 好不好上手，用 Robotium 寫測試可能不容易維護，這些都是需要考量的...

測試工具有：

 * link:../monkeyrunner/monkeyrunner.html[monkeyrunner]
 * link:../robotium/robotium.html[Robotium]
 * link:../calabash/calabash.html[Calabash]

SIKULI 可以用在 device/emulator 上，但 emulator 上可以用 ID 定位，device 上只能省去抓座標的時間。真的只有用把細節藏起來才是王道

== MonkeyRunner-Sikuli 整合 ==

* 從原始碼去找出重點, 設計上的考量。
* 不用單一 keyword 的考量是畫面的操作較頻繁，context/process 切換的成本很高。但 QA 用起來確實比較不方便，門檻相對較高。
* 建構在 SIKULI 的原有的概念上，只是轉向 Android 手機而已，重複利用 IDE 降低學習門檻。這也就是為什麼不直接整背後 OpenCV 的關係。
* no rooting is required，即便手機螢幕大過 desktop
* work on both Android-powered devices and emulators. The concept even can be applied to iOS devices.
* L10N 拍圖的考量比較難滿足
* 合併 image-based 跟 component-based
* 跟 Robot Framework 整合 (in/out)
* 就算是 emulator, 有些東西還是點不到。但就算是 emulator 暫時對 L10N 不那麼重要，對 PDG 測試可以跨 device 也是很重要的。SIKULI 的價值應該是在 visual comparison
* Sqlite 操作確實應該回到？留在 script 裡的應該都是 visual
* Verification - visual comparison, database, logs
* 缺點是桌面的 SIKULI 是多餘的，或許最好的方式是用 OpenCV 重新實作 SIKULI API
* veirfy = visual + log
* 如何操控多個 device？一個 screen 代表一個 device？

== 延伸閱讀 ==

 * link:sikuli.html[用 Sikuli 來測試 Android]

== 參考資料 ==

.網站
--
 * http://developer.android.com/tools/testing/testing_android.html[Testing Fundamentals | Android Developers]
 * http://dtmilano.blogspot.com/[Diego Torres Milano's blog] - Android Application Testing Guide 作者的網站
--

.官方文件
--
 * http://developer.android.com/guide/topics/testing/index.html[Testing | Android Developers] - 關於 Android 的測試，從這裡看起...
 * http://developer.android.com/tools/testing/testing_android.html[Testing Fundamentals | Android Developers]
   ** at every level from unit to framework.
   ** Android test suites are based on JUnit.
   ** The Android JUnit extensions provide component-specific test case classes. These classes provide helper methods for creating mock objects and methods that help you control the lifecycle of a component.
   ** To facilitate dependency injection in testing, Android provides classes that create mock system objects. Mock objects isolate tests from a running system by stubbing out or overriding normal operations.
   ** Also, instrumentation can load both a test package and the application under test into the same process. Since the application components and their tests are in the same process, the tests can invoke methods in the components, and modify and examine fields in the components.
 * http://developer.android.com/resources/tutorials/testing/helloandroid_test.html[Hello, Testing | Android Developers]
 * http://developer.android.com/resources/tutorials/testing/activity_test.html[Activity Testing | Android Developers]
 * http://developer.android.com/guide/developing/testing/index.html[Testing | Android Developers]
   ** http://developer.android.com/guide/developing/testing/testing_eclipse.html[Testing from Eclipse with ADT | Android Developers]
   ** http://developer.android.com/guide/developing/testing/testing_otheride.html[Testing from Other IDEs | Android Developers]
--

.書籍
--
 * http://www.packtpub.com/android-application-testing-guide/book[Packt - Android Application Testing Guide] (2011.06)
--

.投影片
--
 * http://www.slideshare.net/bitbar/android-testing-8364839[Android testing] - 提及 Monkey, Monkeyrunner, Robotium, Roboelectric, Cucumber。其中 "Avoid using emulators and rooted devices" 的觀點很特別...
--

.工具
--
 * http://developer.android.com/guide/developing/tools/index.html[Tools | Android Developers]
   ** http://developer.android.com/guide/developing/tools/adb.html[Android Debug Bridge (adb)]
 * http://testdroid.com/[Testdroid]
   ** 提供 Testdroid Recorder (Eclipse plugin) 錄製操作的過程，上傳到 Testdroid Cloud 同步在多個 device 執行。
   ** 錄製的結果適用 monkeyrunner 和 Robotium。
   ** 收費的項目竟是 Recorder 而非 Cloud，每個月要價 US$99。
--

.其他文件
--
 * http://www.infoq.com/news/2011/09/Android-Testing[Automated Testing Solutions for Android] (2011-09-30) - 主要在講 LessPainful 這個 TaaS，也是跑在 Instrumentation 之上。提到差異 OS versions > Themes > Hardware > Manufacture。
 * http://www.mail-archive.com/android-developers@googlegroups.com/msg154905.html[Re: [android-developers] Re: Unit testing framework with monkeyrunner] (2011-04-19)
 * http://www.juddsolutions.com/downloads/UnitAndFunctionalTestingForAndroidPlatform.pdf[Unit and Functional Testing for the Android Platform] - 比較了 JUnit/Instrumentation、MonkeyRunner、Monkey、Robotium 的做法，將 JUnit/Instrumentation 歸類在 Unit Test。當然同樣是架構在 Instrumentation 之上的 Robotium 被歸類為 functional test，只是作者也直言 "not approachable by traditional testers"。
 * http://site.douban.com/widget/notes/113383/note/161520844/[android測試是孤獨的] (2011-07-15) - 可以朝著 Monkey、Sikuli、Robotium、monkeyrunner、instrumentation 等方向前進。
 * http://pontiffkao.blogspot.com/2011/05/android.html[渺小且微不足道的晦暗: Android 自動化測試蒐集] (2011-05-11)
 * http://mars5337.iteye.com/blog/750339[Android自動化測試可行性途徑分析 - - ITeye技術網站] (2010-08-30)
--

 * http://www.directrss.co.il/TextPage_EN.aspx?ID=6978646[Diego Torres Milano''s blog] - 作者收集了將在 OSCON 2012 上講的東西？

== 雜記 ==

 * http://blog.anscamobile.com/2011/08/automated-testing-on-mobile-devices-part1/[(Part 1) Automated Testing on Mobile Devices for iOS and Android | Ansca Mobile Blog | » Archive] - 五連發，值得一看。
 * http://www.youtube.com/watch?v=EBFtH5tj7Cw[Android Test Automation - YouTube]
 * http://www.infoq.com/news/2011/09/Android-Testing[InfoQ: Automated Testing Solutions for Android] (2011-09-03)
 * http://mylifewithandroid.blogspot.com/2008/11/test-driving-android-gui.html[My life with Android :-): Test-driving Android GUI] (2008-11-06) - SDK 內建 Android instrumentation framework，可以用來測 UI。
 * http://code.google.com/p/scirocco/[scirocco - A UI Test Automation Tool for Android - Google Project Hosting] - 包裝 Robotium。
 * https://sites.google.com/site/mobilewirelesstestautomation/draft-material-on-mobile-wireless/testing-techniques-for-android-applications[Testing techniques for Android applications - mobile wireless test automation] - 測 browser 的話建議用 Selenium 2.0 WebDriver，還有許多其他文件的連結...
 * http://www.slideshare.net/dorieven/banchmark-android-ui-tools-3537546[Benchmark Android automation Tools (for Test Automation)]
 * AutomateIt
   ** http://lifehacker.com/5782502/automateit-is-a-simple-and-free-android-automation-tool[AutomateIt Is a Simple and Free Android Automation Tool] (2011-03-16)
   ** 有人稱這就是手機上的 http://marcolibrary.blogspot.com/2011/06/ifthisthenthat-iftttcom.html[ifttt]
   ** 設定一些 trigger，當條件成立時就執行對應的 action。
   ** 跟 Tasker 很像，但它是 automation，但跟 test automation 無關。
 * http://code.google.com/p/autoandroid/[autoandroid - Tools for automating android projects.. so you can just write code! - Google Project Hosting] - 已停止開發
 * http://brainflush.wordpress.com/2010/01/10/introducing-calculon-a-java-dsl-for-android-activity-testing/[Introducing Calculon – a Java DSL for Android Activity testing « Brain Flush]
 * http://pivotal.github.com/robolectric/index.html[Robolectric: Unit Test your Android Application | Robolectric]
   ** 不是跑在 InstrumentationTestRunner 之上，但可以加快測試的速度，值得一看。
 * http://developer.android.com/guide/developing/tools/monkeyrunner_concepts.html[monkeyrunner | Android Developers]
 * https://www.lesspainful.com/[LessPainful · Mobile Application Testing] 雲端測試，測試用http://cukes.info/[Cucumber]寫（一種 BDD 方案）
 * 是 Android Emulator 而非 Simulator。http://neochung.blogspot.com/2008/09/simulator-emulator.html[Simulator 和 Emulator的差異 | Darkman Side] (2008-09-28)
 * http://blog.codecentric.de/en/2011/03/android-testing-in-brief/[Android testing in brief | codecentric Blog] (2011-03-15)
 * http://www.simpligility.com/2011/11/testing-android-applications-going-from-zero-to-hero/[Testing Android Applications – Going from Zero to Hero | simpligility] (2011-11-06)
 * http://pivotal.github.com/robolectric/[Robolectric: Unit Test your Android Application | Robolectric]
 * http://www.artima.com/scalazine/articles/borachio_mock_objects_for_scala.html[Borachio: Mock Objects for Scala and Android]


