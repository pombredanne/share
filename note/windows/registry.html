<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.8" />
<title>Windows Registry</title>
<link rel="stylesheet" href="../../_asciidoc/stylesheets/asciidoc.css" type="text/css" />
<link rel="stylesheet" href="../../_asciidoc/stylesheets/layout2.css" type="text/css" />
<link rel="stylesheet" href="../../_asciidoc/stylesheets/pygments.css" type="text/css" />
<link rel="Stylesheet" href="http://www.diigo.com/stylesheets/link_rolls_standard.css" title="style_standard" type="text/css" media="screen" />
<script type="text/javascript" src="../../_asciidoc/javascripts/asciidoc.js"></script>
<script type="text/javascript">
/*<![CDATA[*/
asciidoc.install();
/*]]>*/
</script>
</head>
<body>
<div id="layout-menu-box">
<div id="layout-menu">
  <div><a href="../../index.html">首頁</a> | <a href="http://www.diigo.com/user/imsardine" target="_blank">閱讀</a> | <a href="../../note/index.html">筆記</a></div>
  <div>
    <img src="http://www.gravatar.com/avatar/ca5d67276ca1ff3e5391438d7865ddf2" width="32" style="border:none"/>
    <a href="http://imsardine.wordpress.com/" target="_blank"><img src="http://s.wordpress.org/about/images/logos/wordpress-logo-32-blue.png" style="border:none"/></a>
  </div>
  <iframe src="http://githubbadge.appspot.com/badge/imsardine?s=1" style="border: 0;height: 142px;width: 200px;overflow: hidden;" frameBorder=0></iframe>
</div>
</div>
<div id="layout-content-box">
<div id="layout-banner">
  <div id="layout-title">在電梯裡遇見雙胞胎</div>
  <div id="layout-description">腦袋不是用來裝東西，而是用來思考問題的；所以我把懶得記的、記不住的，通通寫在這裡... <a href="http://www.diigo.com" onclick="var s=document.createElement('script');s.type='text/javascript';s.src='http://www.diigo.com/javascripts/webtoolbar/diigolet_b_h_b.js';document.body.appendChild(s);return false;"><img style="border:none" alt="Add to Diigo" src="http://www.diigo.com/images/diigo-icon/16.png" /></a></div>
</div>
<div id="layout-content">
<div id="header">
<h1>Windows Registry</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>要操作 registry 前，要先搞清楚 key、value、name、data 之間的關係才行。</p></div>
<div class="paragraph"><p>基本上 registry 就是由 registry key/subkey 組成的樹狀結構，每一個 registry key 下都有一或多個 registry value，也就是 name/data pair（注意跟傳統 key/value pair 的說法不同）。</p></div>
<div class="paragraph"><p>更正確地來說，每一個 registry key 下都有一個 default/unnamed value 與零或多個 named value；所謂 unnamed value 指的就是 name 為空字串的 registry value，每個 registry key 底下都有一個 default/unnamed value，而且型態固定是 <code>REG_SZ</code>。</p></div>
<div class="imageblock">
<div class="content">
<img src="registry/firefox_reg.png" alt="registry/firefox_reg.png" />
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_延伸閱讀">延伸閱讀</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
<a href="../python/windows/registry.html">用 Python 存取 Windows Registry</a>
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_參考資料">參考資料</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
<a href="http://en.wikipedia.org/wiki/Windows_Registry">Windows Registry - Wikipedia, the free encyclopedia</a>
</p>
</li>
<li>
<p>
<a href="http://msdn.microsoft.com/en-us/library/ms724884%28v=VS.85%29.aspx">Registry Value Types (Windows)</a>
</p>
</li>
<li>
<p>
<a href="http://msdn.microsoft.com/en-us/library/ms724878%28v=VS.85%29.aspx">Registry Key Security and Access Rights (Windows)</a>
</p>
</li>
<li>
<p>
<a href="http://msdn.microsoft.com/en-us/library/aa384129">Accessing an Alternate Registry View (Windows)</a>
</p>
</li>
<li>
<p>
<a href="http://en.wikipedia.org/wiki/WoW64">WoW64 - Wikipedia, the free encyclopedia</a>
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_學習筆記">學習筆記</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
The Windows Registry is a <em>'hierarchical database</em>' that stores configuration settings and options on Microsoft Windows operating systems.
</p>
<div class="ulist"><ul>
<li>
<p>
It contains settings for low-level operating system components as well as the applications running on the platform: the kernel, device drivers, services, SAM, user interface and third party applications all make use of the Registry.
</p>
</li>
<li>
<p>
When first introduced with Windows 3.1, the Windows registry&#8217;s primary purpose was to store configuration information for COM-based components. With the introduction of Windows 95 and Windows NT, its use was extended to tidy up the profusion of <em>'per-program INI files</em>' that had previously been used to store configuration settings for Windows programs (現在還是很常這樣用).
</p>
</li>
</ul></div>
</li>
<li>
<p>
The registry contains two basic elements: keys and values.
</p>
</li>
<li>
<p>
Registry keys are similar to folders
</p>
<div class="ulist"><ul>
<li>
<p>
In addition to values, each key can contain subkeys, which may contain further subkeys, and so on. (把 key 想成是 folder, 而 value 想成是檔案, registry 的結構就會變得很直觀)
</p>
<div class="ulist"><ul>
<li>
<p>
Keys are referenced with a syntax similar to Windows' path names, using backslashes to indicate levels of hierarchy. (一樣不分大小寫, 注意分隔字元是 <em>\</em> 而非 <em>/</em>)
</p>
</li>
<li>
<p>
E.g. <code>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows</code> refers to the subkey "Windows" of the subkey "Microsoft" of the subkey "Software" of the <code>HKEY_LOCAL_MACHINE</code> root key.
</p>
</li>
</ul></div>
</li>
<li>
<p>
Each subkey has a mandatory name which is a non-empty string that cannot contain any backslash or null character, and whose letter case is insignificant.
</p>
</li>
<li>
<p>
Like other files and services in Windows, all registry keys may be restricted by access control lists (ACLs). Different users, programs, services or remote systems may only see only some parts of the hierarchy or distinct hierarchies from the same root keys。（取得最小的權限即可，否則系統會擋掉某些操作；Vista 之後的 UAC 情況更是嚴重）
</p>
</li>
</ul></div>
</li>
<li>
<p>
The hierarchy of registry keys can only be accessed from a known <em>'root key handle</em>'. There are seven predefined root keys, traditionally named according to their constant handles defined in the Win32 API, or by synonymous abbreviations (depending on applications)
</p>
<div class="ulist"><ul>
<li>
<p>
HKEY_LOCAL_MACHINE (HKLM) - 這是最常用的
</p>
<div class="ulist"><ul>
<li>
<p>
Registry entries subordinate to this key define the physical state of the computer, including data about the bus type, system memory, and installed hardware and software.
</p>
</li>
</ul></div>
</li>
<li>
<p>
HKEY_CURRENT_CONFIG (HKCC)
</p>
<div class="ulist"><ul>
<li>
<p>
only in Windows 9x/ME and NT-based versions of Windows
</p>
</li>
<li>
<p>
Contains information about the current hardware profile of the local computer system.
</p>
</li>
</ul></div>
</li>
<li>
<p>
HKEY_CLASSES_ROOT (HKCR)
</p>
<div class="ulist"><ul>
<li>
<p>
Registry entries subordinate to this key define types (or classes) of documents and the properties associated with those types.
</p>
</li>
<li>
<p>
Shell and COM applications use the information stored under this key.
</p>
</li>
</ul></div>
</li>
<li>
<p>
HKEY_CURRENT_USER (HKCU)
</p>
<div class="ulist"><ul>
<li>
<p>
Registry entries subordinate to this key define the preferences of the current user.
</p>
</li>
<li>
<p>
These preferences include the settings of environment variables, data about program groups, colors, printers, network connections, and application preferences.
</p>
</li>
</ul></div>
</li>
<li>
<p>
HKEY_USERS (HKU)
</p>
<div class="ulist"><ul>
<li>
<p>
Registry entries subordinate to this key define the default user configuration for new users on the local computer and the user configuration for the current user.
</p>
</li>
</ul></div>
</li>
<li>
<p>
HKEY_PERFORMANCE_DATA
</p>
<div class="ulist"><ul>
<li>
<p>
only in NT-based versions of Windows, but invisible in the Windows Registry Editor
</p>
</li>
<li>
<p>
Registry entries subordinate to this key allow you to access performance data. The data is not actually stored in the registry; the registry functions cause the system to collect the data from its source.
</p>
</li>
</ul></div>
</li>
<li>
<p>
HKEY_DYN_DATA
</p>
<div class="ulist"><ul>
<li>
<p>
only in Windows 9x/ME, and visible in the Windows Registry Editor
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
Registry values are name/data pairs stored within keys
</p>
<div class="ulist"><ul>
<li>
<p>
注意這裡 "name/data" 的說法與一般常見的 "name/value" 不同（因為 value 已經被拿去表示其他東西了）, 雖然我們常將 registry values 稱做 named values.
</p>
</li>
<li>
<p>
All registry values stored in a registry key have a unique name whose letter case is not significant.
</p>
</li>
<li>
<p>
Registry values are referenced separately from registry keys.
</p>
<div class="ulist"><ul>
<li>
<p>
The Windows API functions that query and manipulate registry values take value names separately from the key path and/or handle that identifies the parent key.
</p>
</li>
<li>
<p>
Registry values may contain backslashes in their name but doing so makes them difficult to distinguish from their key paths when using some legacy Windows Registry API functions (whose usage is deprecated in Win32).
</p>
</li>
</ul></div>
</li>
<li>
<p>
Each value can store arbitrary data with variable length and <em>'encoding</em>', but which is associated with a <em>'symbolic type</em>' (defined as a numeric constant) defining how to parse this data. 常用的有:
</p>
<div class="ulist"><ul>
<li>
<p>
REG_SZ (1) - A string value, normally stored and exposed in UTF-16LE (when using the Unicode version of Win32 API functions), usually terminated by a null character
</p>
</li>
<li>
<p>
REG_EXPAND_SZ (2) - An "expandable" string value that can contain environment variables, normally stored and exposed in UTF-16LE, usually terminated by a null character
</p>
</li>
<li>
<p>
REG_BINARY (3) - Binary data (any arbitrary data)
</p>
</li>
<li>
<p>
REG_DWORD (4) - A <code>DWORD</code> value, a 32-bit unsigned integer (numbers between 0 and 4,294,967,295 [232 – 1]) (little-endian)
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
The terminology is somewhat misleading, as each registry key is similar to an <em>'associative array</em>'(也就是常見的 map 或 dictionary 等), where standard terminology would refer to the name part of each registry value as a "key".
</p>
<div class="ulist"><ul>
<li>
<p>
The terms are a holdout from the 16-bit registry in Windows 3, in which registry keys could not contain arbitrary name/data pairs, but rather contained only one <em>'unnamed value</em>' (which had to be a string).
</p>
</li>
<li>
<p>
In this sense, the entire registry was like a single associative array where the registry keys (in both the registry sense and dictionary sense) formed a hierarchy, and the <em>'registry values</em>' were all strings.
</p>
</li>
<li>
<p>
When the 32-bit registry was created, so was the additional capability of creating multiple named values per key, and the meanings of the names were somewhat distorted.
</p>
</li>
<li>
<p>
For compatibility with the previous behavior, each registry key may have a "default" value, whose name is the <em>'empty string</em>'. 例如 Python 2.7 裝設完成之後, HKLM\SOFTWARE\Python\PythonCore\2.7\PythonPath 底下就只有一個名為 "(Default)" 的 Unnamed/Default Value, 型態是 REG_SZ
</p>
</li>
</ul></div>
</li>
</ul></div>
</div>
</div>
<div id="disqus_thread"></div>
<script type="text/javascript">
var disqus_shortname = 'imsardine'; // required: replace example with your forum shortname
(function() {
var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2012-12-16 23:28:34 CST
</div>
</div>
</div>
</div>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script type="text/javascript" src="http://s.gravatar.com/js/gprofiles.js?ver=e"></script>
<script>jQuery(document).ready(function($){ Gravatar.init(); });</script>
</body>
</html>
