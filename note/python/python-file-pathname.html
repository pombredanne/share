<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.8" />
<title>[Python] 檔名跟路徑的處理</title>
<link rel="stylesheet" href="../../_asciidoc/stylesheets/asciidoc.css" type="text/css" />
<link rel="stylesheet" href="../../_asciidoc/stylesheets/layout2.css" type="text/css" />
<link rel="stylesheet" href="../../_asciidoc/stylesheets/pygments.css" type="text/css" />
<link rel="Stylesheet" href="http://www.diigo.com/stylesheets/link_rolls_standard.css" title="style_standard" type="text/css" media="screen" />
<script type="text/javascript" src="../../_asciidoc/javascripts/asciidoc.js"></script>
<script type="text/javascript">
/*<![CDATA[*/
asciidoc.install();
/*]]>*/
</script>
</head>
<body>
<div id="layout-menu-box">
<div id="layout-menu">
  <div><a href="../../index.html">首頁</a> | <a href="http://www.diigo.com/user/imsardine" target="_blank">閱讀</a> | <a href="../../note/index.html">筆記</a></div>
  <div>
    <img src="http://www.gravatar.com/avatar/ca5d67276ca1ff3e5391438d7865ddf2" width="32" style="border:none"/>
    <a href="http://imsardine.wordpress.com/" target="_blank"><img src="http://s.wordpress.org/about/images/logos/wordpress-logo-32-blue.png" style="border:none"/></a>
  </div>
  <iframe src="http://githubbadge.appspot.com/badge/imsardine?s=1" style="border: 0;height: 142px;width: 200px;overflow: hidden;" frameBorder=0></iframe>
</div>
</div>
<div id="layout-content-box">
<div id="layout-banner">
  <div id="layout-title">在電梯裡遇見雙胞胎</div>
  <div id="layout-description">腦袋不是用來裝東西，而是用來思考問題的；所以我把懶得記的、記不住的，通通寫在這裡... <a href="http://www.diigo.com" onclick="var s=document.createElement('script');s.type='text/javascript';s.src='http://www.diigo.com/javascripts/webtoolbar/diigolet_b_h_b.js';document.body.appendChild(s);return false;"><img style="border:none" alt="Add to Diigo" src="http://www.diigo.com/images/diigo-icon/16.png" /></a></div>
</div>
<div id="layout-content">
<div id="header">
<h1><a href="python.html">Python</a> / <a href="python-file.html">Files</a> / Pathname</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_目前所在目錄">目前所在目錄</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
os.chdir(path)
</p>
</li>
<li>
<p>
os.getcwd()
</p>
</li>
<li>
<p>
<code>os.sep</code> - 目錄分隔字元。例如 Windows 下的 <code>\</code> 跟 Unix-like 下的 <code>/</code>。
</p>
</li>
<li>
<p>
<code>os.pathsep</code> - 路徑分隔字元。例如 Widdows 下的 <code>;</code> 跟 Unix-like 下的 <code>:</code>。
</p>
</li>
<li>
<p>
<code>os.path.abspath(path)</code> - 用目前所在目錄做為起點，傳回相對路徑 <em>path</em> 的絕對表示法，也就是 <code>normpath(join(os.getcwd(), path))</code> 的結果。
</p>
</li>
<li>
<p>
<code>os.path.exists(path)</code> - 檢查檔案目錄是否存在。
</p>
</li>
<li>
<p>
<code>os.path.basename(path)</code> - 也就是 <code>split()</code> 傳回的 <em>tail</em>。
</p>
</li>
<li>
<p>
<code>os.path.dirname(path)</code> - 取得檔案所在的目錄，或是目錄的上層目錄，也就是 <code>split()</code> 傳回的 <em>head</em>。
</p>
</li>
<li>
<p>
<code>os.path.expanduser(path)</code> - 將 <code>~\My Documents</code> 展開成完成的路徑，其中 <code>~</code> 會被置換成家目錄。
</p>
</li>
<li>
<p>
<code>os.path.isabs(path)</code> - 判斷 <em>path</em> 是否為絕對路徑的表示法。
</p>
<div class="openblock">
<div class="content">
<div class="paragraph"><p>&gt;&gt;&gt; import os.path
&gt;&gt;&gt; os.path.expanduser(r'~\My Documents\Downloads')
<em>C:\\Documents and Settings\\Administrator\\My Documents\\Downloads</em></p></div>
</div></div>
</li>
<li>
<p>
<code>os.path.normpath(path)</code> - 拿掉多餘的目錄分隔字元或上層目錄的參照（<code>..</code>），在 Windows 下更會將斜線（<code>/</code>）置換成反斜線（<code>\</code>）。
</p>
</li>
<li>
<p>
<code>os.path.normcase(path)</code> - 聽起來像是會將檔案目錄名稱的大小寫調整成跟檔案系統裡實際的名稱一樣，但實際上並不是這麼回事，跟檔案目錄是否存在也無關。
</p>
</li>
<li>
<p>
`os.path.realpath(path) - 將路徑中的 symbolic link 目錄轉換成實際的，跟檔案目錄是否存在也無關。
</p>
</li>
<li>
<p>
`os.path.relpath(path[, start]) - 可以用來算出兩個檔案間的相對路徑
</p>
</li>
<li>
<p>
`os.path.splitdrive(path)
</p>
</li>
<li>
<p>
<code>os.path.splitext(path)</code> - 傳回 <code>(root, ext)</code>，其中 <em>ext</em> 包含 <code>.</code> 字元；可以用來取出副檔名
</p>
</li>
<li>
<p>
<code>os.path.split(path)</code> - 傳回 <code>(head, tail)</code>。就結果來看，<code>path == os.path.join(*os.path.split(path))</code> 是個恆等式。
</p>
</li>
<li>
<p>
<code>os.path.join(path1[, path2[, ...]])</code> - 用目錄分隔字元（<code>os.sep</code>）將路徑串接起來。
</p>
</li>
<li>
<p>
<code>os.path.isabs(path)</code> - 判斷 <em>path</em> 是不是絕對路徑的表示法
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="../../_asciidoc/images/icons/tip.png" alt="Tip" />
</td>
<td class="content">為了讓程式可以跨平台執行，目錄分隔字元（例如 Windows 的 <code>\</code> 或 Linux 的 <code>/</code>）用 <code>os.sep</code> 取代，多個路徑的分隔字元（path separator，例如 Windows 的 <code>;</code> 或 Linux 的 <code>:</code>）則用 <code>os.pathsep</code> 取代。</td>
</tr></table>
</div>
<div class="listingblock">
<div class="content">
<pre><code>&gt;&gt;&gt; import os.path as path
&gt;&gt;&gt; path.split('/tmp/abc.txt')    <img src="../../_asciidoc/images/icons/callouts/1.png" alt="1" />
('/tmp', 'abc.txt')
&gt;&gt;&gt; path.dirname('/tmp/abc.txt')
'/tmp'
&gt;&gt;&gt; path.basename('/tmp/abc.txt')
'abc.txt'
&gt;&gt;&gt; path.splitext('/tmp/abc.txt') <img src="../../_asciidoc/images/icons/callouts/2.png" alt="2" />
('/tmp/abc', '.txt')
&gt;&gt;&gt; path.splitext('/tmp/abc')     <img src="../../_asciidoc/images/icons/callouts/3.png" alt="3" />
('/tmp/abc', '')
&gt;&gt;&gt; path.splitext(path.basename('/tmp/abc.txt')) <img src="../../_asciidoc/images/icons/callouts/4.png" alt="4" /></code></pre>
</div></div>
<div class="colist arabic"><table>
<tr><td><img src="../../_asciidoc/images/icons/callouts/1.png" alt="1" /></td><td>
拆出路徑跟檔名。也就是 <code>dirname()</code> 跟 <code>basename()</code> 結果的集合。
</td></tr>
<tr><td><img src="../../_asciidoc/images/icons/callouts/2.png" alt="2" /></td><td>
單拆出副檔名的部部份。注意副檔名的部份包含前面的點（<code>.</code>）。
</td></tr>
<tr><td><img src="../../_asciidoc/images/icons/callouts/3.png" alt="3" /></td><td>
沒有副檔名時，傳回空字串。
</td></tr>
<tr><td><img src="../../_asciidoc/images/icons/callouts/4.png" alt="4" /></td><td>
<code>splitext()</code> 比較常拿來處理檔名的部份。
</td></tr>
</table></div>
<div class="paragraph"><p>其中 <code>normpath()</code>、<code>normcase()</code> 及 <code>realpath()</code> 很容易讓人混淆。透過下面這些實例，可以更清楚它們的區別：</p></div>
<div class="listingblock">
<div class="title">Unix-like</div>
<div class="content">
<pre><code>/tmp$ ls -l | grep -i foo
lrwxrwxrwx  1 user user    6 2011-10-17 16:57 foobar-link -&gt; FOOBAR
drwxr-xr-x  2 user user 4096 2011-10-17 17:05 FOOBAR
-rw-r--r--  1 user user    0 2011-10-17 17:04 foobar.file

/tmp$ cd foobar-link; ls -l | grep foo; cd ..
lrwxrwxrwx 1 user user 16 2011-10-17 17:05 foobar.file -&gt; /tmp/foobar.file

/tmp$ python
&gt;&gt;&gt; from os import path
&gt;&gt;&gt; path.exists('/tmp/foo'), path.exists('/tmp/foobar-link'), path.exists('/tmp/FOOBAR')
(False, True, True)
&gt;&gt;&gt; path.normpath('//tmp/foobar-link/..//foo')
'//tmp/foo'                                               <img src="../../_asciidoc/images/icons/callouts/1.png" alt="1" />
&gt;&gt;&gt; path.normpath(r'//tmp/foobar-link/..\foo')
'//tmp/foobar-link/..\\foo'                               <img src="../../_asciidoc/images/icons/callouts/2.png" alt="2" />
&gt;&gt;&gt; path.normcase('//tmp/foobar-link/..//foo')
'//tmp/foobar-link/..//foo'                               <img src="../../_asciidoc/images/icons/callouts/3.png" alt="3" />
&gt;&gt;&gt; path.realpath('/tmp/foo')
'/tmp/foo'
&gt;&gt;&gt; path.realpath('/tmp/foo//..//foobar-link')
'/tmp/foobar-link'                                        <img src="../../_asciidoc/images/icons/callouts/4.png" alt="4" />
&gt;&gt;&gt; path.realpath(path.normpath('/tmp/foo//..//foobar-link'))
'/tmp/FOOBAR'                                             <img src="../../_asciidoc/images/icons/callouts/5.png" alt="5" />
&gt;&gt;&gt; path.realpath(path.normpath('/tmp/foo//..//foobar-link/foobar.file'))
'/tmp/foobar.file'                                        <img src="../../_asciidoc/images/icons/callouts/6.png" alt="6" /></code></pre>
</div></div>
<div class="colist arabic"><table>
<tr><td><img src="../../_asciidoc/images/icons/callouts/1.png" alt="1" /></td><td>
<code>normpath()</code> 單純做路徑表示法的正規化，跟檔案目錄是否存在無關。（為什麼 root 的 <code>//</code> 不會被併成一個？）
</td></tr>
<tr><td><img src="../../_asciidoc/images/icons/callouts/2.png" alt="2" /></td><td>
在非 Non-Windows 下，<code>normpath()</code> 並不會自動將反斜線（<code>\</code>）置換成斜線（<code>/</code>）。
</td></tr>
<tr><td><img src="../../_asciidoc/images/icons/callouts/3.png" alt="3" /></td><td>
在非 Non-Windows 下，<code>normcase()</code> 不會將路徑表示法正規化；事實上，它將 <em>path</em> 原封不動地回傳，因此它的實用性並不高。
</td></tr>
<tr><td><img src="../../_asciidoc/images/icons/callouts/4.png" alt="4" /></td><td>
可以觀察到，如果過程中如果遇到不存在的檔案目錄（不會丟出例外），<code>realpath()</code> 的行為單純就像是 <code>normpath()</code>。
</td></tr>
<tr><td><img src="../../_asciidoc/images/icons/callouts/5.png" alt="5" /></td><td>
先用 <code>normpath()</code> 處理過，<code>realpath()</code> 比較能發揮它的作用。
</td></tr>
<tr><td><img src="../../_asciidoc/images/icons/callouts/6.png" alt="6" /></td><td>
除了目錄之外，<code>realpath()</code> 同樣也可以作用在檔案上。
</td></tr>
</table></div>
<div class="listingblock">
<div class="title">Windows</div>
<div class="content">
<pre><code>&gt;&gt;&gt; from os import path
&gt;&gt;&gt; path.exists(r'C:\tmp\foo'), path.exists(r'C:\tmp\foobar-link'), path.exists(r'C:\tmp\foobar')    <img src="../../_asciidoc/images/icons/callouts/1.png" alt="1" />
(False, True, True)
&gt;&gt;&gt; path.normpath(r'C:\\tmp\foobar-link\..\\foobar')
'C:\\tmp\\foobar'
&gt;&gt;&gt; path.normpath(r'C:\tmp\foobar-link/..//FOO')                      <img src="../../_asciidoc/images/icons/callouts/2.png" alt="2" />
'C:\\tmp\\FOO'
&gt;&gt;&gt; path.normcase(r'C:\tmp\foobar-link/..//FOO')
''c:\\tmp\\foobar-link\\..\\\\foo'                                    <img src="../../_asciidoc/images/icons/callouts/3.png" alt="3" />
&gt;&gt;&gt; path.realpath(r'C:\tmp\foo/..//foobar-link')
'C:\\tmp\\foobar-link'                                                <img src="../../_asciidoc/images/icons/callouts/4.png" alt="4" />
&gt;&gt;&gt; path.realpath(path.normpath(r'C:\tmp\foo/..//foobar-link'))
'C:\\tmp\\foobar-link'                                                <img src="../../_asciidoc/images/icons/callouts/5.png" alt="5" /></code></pre>
</div></div>
<div class="colist arabic"><table>
<tr><td><img src="../../_asciidoc/images/icons/callouts/1.png" alt="1" /></td><td>
Windows 下檔案目錄的名稱不分大小寫，但實際的大小寫是 <code>C:\tmp\FOOBAR</code>，而 <code>C:\tmp\foobar-link</code> 是指向該目錄的 symbolic link。
</td></tr>
<tr><td><img src="../../_asciidoc/images/icons/callouts/2.png" alt="2" /></td><td>
<code>normpath()</code> 在 Windows 下除了做路徑表示法的正規化之外（跟檔案目錄是否存在無關），也會將斜線（<code>/</code>）置換成反斜線（<code>\</code>）。
</td></tr>
<tr><td><img src="../../_asciidoc/images/icons/callouts/3.png" alt="3" /></td><td>
在 Windows 下，<code>normcase()</code> 雖然會將斜線（<code>/</code>）置換成反斜線（<code>\</code>），但它只是將檔案目錄的名稱轉為小寫（跟它是否真的存在無關），也不會對路徑表示法做正規化，因此它的實用性並不高。
</td></tr>
<tr><td><img src="../../_asciidoc/images/icons/callouts/4.png" alt="4" /></td><td>
如果過程中如果遇到不存在的檔案目錄（不會丟出例外），<code>realpath()</code> 的行為單純就像是 <code>normpath()</code>。
</td></tr>
<tr><td><img src="../../_asciidoc/images/icons/callouts/5.png" alt="5" /></td><td>
用 <code>normpath()</code> 先處理過，狀況並不會比較好，因為這是個 <a href="http://bugs.python.org/issue9949">bug</a>&#8230;
</td></tr>
</table></div>
</div>
</div>
<div class="sect1">
<h2 id="_如何取得相對於某個_py_檔的絕對路徑">如何取得相對於某個 .py 檔的絕對路徑</h2>
<div class="sectionbody">
<div class="paragraph"><p>Java 的 <code>Class</code> 提供有一個 <a href="http://download.oracle.com/javase/1.5.0/docs/api/java/lang/Class.html#getResource%28java.lang.String%29"><code>getResource(name)</code></a> 方法，可以用相對某 <code>.class</code> 檔的位置來解讀 <code>name</code> 所表示的相對路徑。</p></div>
<div class="paragraph"><p>在 Python 裡也有類似的需求，為了程式的可攜性，需要以相對於 <code>.py</code> 檔的方式來描述某個外部檔的位置。假設下面的目錄結構：</p></div>
<div class="listingblock">
<div class="content">
<pre><code>/tmp$ tree a
a/
|-- a.txt &lt;-- 內容為 "content of a.txt"
`-- b/
    |-- c/
    |-- mod.py
    `-- othermod.py

2 directories, 2 files</code></pre>
</div></div>
<div class="paragraph"><p><code>/tmp/a/b/mod.py</code> 會將 <code>/tmp/a.txt</code> 的內容印容印出。它的內容如下：</p></div>
<div class="listingblock">
<div class="content">
<pre><code>import os
from os.path import dirname, abspath, join

# 取得 mod.py 所在的路徑 (相對於 current working directory)
mod_dir = dirname(__file__)
# 不直接寫成 '../a.txt' 是為了不要跟 OS 相依
a_pathname = abspath(join(mod_dir, '..', 'a.txt'))

print 'CWD:', os.getcwd()
print open(a_pathname, 'r').read()</code></pre>
</div></div>
<div class="paragraph"><p>不論從哪個位置執行 <code>mod.py</code> (會導致 current working directory 起變化)，都能正常地印出 <code>/tmp/a/a.txt</code> 的內容：</p></div>
<div class="listingblock">
<div class="content">
<pre><code>/tmp$ python a/b/mod.py
CWD: /tmp
content of a.txt
/tmp$ cd a/b/c
/tmp/a/b/c$ python ../mod.py
CWD: /tmp/a/b/c
content of a.txt</code></pre>
</div></div>
<div class="paragraph"><p>當然也可以藉由其他 module 來定位：</p></div>
<div class="listingblock">
<div class="content">
<pre><code>import os, othermod
from os.path import dirname, abspath, join

mod_dir = dirname(othermod.__file__) # 取得 othermod.py 所在的路徑
a_pathname = abspath(join(mod_dir, '..', 'a.txt'))

print 'CWD:', os.getcwd()
print open(a_pathname, 'r').read()</code></pre>
</div></div>
<div class="paragraph"><p>根據上面的實驗結果，我們可以寫一個 <code>abspath(relpath, mod)</code> 來模擬 Java 中 <code>Class.getResource(name)</code> 的行為，也可以做為 <code>os.path.abspath(path)</code> 的擴充。</p></div>
<div class="listingblock">
<div class="content">
<pre><code>import os

def abspath(relpath, mod):
    # 呼叫端不用擔心不同 OS 的分隔字元
    relpath = relpath.replace('/', os.sep).replace('\\', os.sep)
    if mod is None: return os.path.abspath(relpath)

    base_dir = os.path.dirname(mod.__file__)
    pathname = os.path.join(base_dir, relpath)
    return os.path.abspath(pathname)</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="../../_asciidoc/images/icons/tip.png" alt="Tip" />
</td>
<td class="content">可以用 <code>sys.modules[__name__]</code> 來取得 current module.</td>
</tr></table>
</div>
<div class="paragraph"><p>這裡提到的技巧，也很適合用在執行期動態配置 <code>sys.path</code> 。</p></div>
<div class="paragraph"><p>參考資料：</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://docs.python.org/library/runpy.html">30.7. runpy — Locating and executing Python modules — Python v2.7 documentation</a> 說明了 <code>__file__</code> 的運作原理。
</p>
</li>
<li>
<p>
<a href="http://stackoverflow.com/questions/2817264/how-to-get-the-parent-dir-location-using-python">how to get the parent dir location using python.. - Stack Overflow</a> (2010-05-12)
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_參考資料">參考資料</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
<a href="http://docs.python.org/library/os.path.html">The Python Standard Library &gt; os.path — Common pathname manipulations</a>
</p>
</li>
<li>
<p>
<a href="http://docs.python.org/library/os.html">The Python Standard Library &gt; os — Miscellaneous operating system interfaces</a>
</p>
</li>
</ul></div>
</div>
</div>
<div id="disqus_thread"></div>
<script type="text/javascript">
var disqus_shortname = 'imsardine'; // required: replace example with your forum shortname
(function() {
var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2012-12-16 23:37:44 CST
</div>
</div>
</div>
</div>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script type="text/javascript" src="http://s.gravatar.com/js/gprofiles.js?ver=e"></script>
<script>jQuery(document).ready(function($){ Gravatar.init(); });</script>
</body>
</html>
